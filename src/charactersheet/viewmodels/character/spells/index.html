<div id="spells-pane" class="ac-pane panel-body">
    <div class="h4 card-title">
      Spells<br/>
      <small>You can sort your spells by clicking on the headers. View the
    bottom of the list for a count of your prepared spells.</small>
    </div>
    <table class="listing table table-responsive table-ac-bordered table-hover">
      <thead>
        <tr class="ac-table-header">
          <th>
            <input id="filterByCastable"
                   type='checkbox'
                   class='filter-checkbox sr-only'
                   data-bind="checked: filteredByCastable"></input>
            <label for="filterByCastable">
           </label>
          </th>
          <th data-bind="click: ()=> {sortBy('name');}">
            Spell
            <span data-bind="css: sortArrow('name')"></span>
          </th>
          <th class="ac-table-data-cell"
              data-bind="click: () => {sortBy('level');}">
            Level
            <span data-bind="css: sortArrow('level')"></span>
          </th>
          <th class="hidden-xs"
              data-bind="click: () => {sortBy('typeLabel');}">
            Type
            <span data-bind="css: sortArrow('typeLabel')"></span>
          </th>
          <th class="hidden-xs hidden-sm"
              data-bind="click: () => {sortBy('damageType');}">
            Damage
            <span data-bind="css: sortArrow('damageType')"></span>
          </th>
          <th class="hidden-xs"
              data-bind="click: () => {sortBy('castingTime');}">
            Casting Time
            <span data-bind="css: sortArrow('castingTime')"></span>
          </th>
          <th class="hidden-xs hidden-sm"
              data-bind="click: () => {sortBy('range');}">
            Range
            <span data-bind="css: sortArrow('range')"></span>
          </th>
          <th style="width: 5%" class="toggle-collapse-col">
            <a href="#" data-bind="{click: collapseAll}">
                  <span class="fa fa-minus"></span>
                </a>
          </th>
        </tr>
      </thead>
      <!-- ko if: loaded(), completeOn: 'render' -->
      <tbody>
        <!-- ko foreach: filteredAndSortedEntities -->
        <tr
            data-toggle="collapse"
            class="clickable spellRow"
            data-bind="css: {notCastable: !isCastable()}, attr:{'data-target': `#spell_list_${uuid()}`, id: `#spell_row_${uuid()}`}">
          <td class="memorize-spell"
              data-bind="click: $parent.memorizeSpell">
            <!-- ko ifnot: level() == 0  || alwaysPrepared -->
            <div>
              <input type='checkbox'
                     style=""
                     class='ac-checkbox sr-only'
                     data-bind="checked: prepared, attr: {id: `spell_memorize_${uuid()}`}"></input>
              <label data-bind="attr: {for: `spell_memorize_${uuid()}`}"></label>
            </div>
            <!-- /ko -->
            <!-- ko if: level() == 0  || alwaysPrepared -->
            <span class="glyphicon glyphicon-ok-sign"></span>
            <!-- /ko -->
          </td>
          <td>
            <span data-bind="text: name"></span>
            <!-- ko if: isConcentration -->
            <span style="color: #18bc9c"
                  class="glyphicon glyphicon-copyright-mark"></span>
            <!-- /ko -->
          </td>
          <td class="ac-table-data-cell">
            <span data-bind="text: levelLabel"></span>
          </td>
          <td class="hidden-xs">
            <span data-bind="html: $component.spellTypeLabel($data)"></span>
          </td>
          <td class="hidden-xs  hidden-sm">
            <span data-bind="css: spellDamageIcon"></span>
            <span data-bind="text: damage"></span>
          </td>
          <td class="hidden-xs">
            <span data-bind="text: castingTime"></span>
            <!-- ko if: isRitual -->
            <span style="color: #18bc9c"
                  class="glyphicon glyphicon-registration-mark"></span>
            <!-- /ko -->
          </td>
          <td class="hidden-xs hidden-sm">
            <span data-bind="text: $component.trunc(range, 10)"></span>
          </td>
          <td style="width: 5%" class="toggle-collapse-col">
            <span data-toggle="collapse"
                  data-bind="attr:{'data-target': `#spell_list_${uuid()}`}"
                  class="rotate fa fa-chevron-left"></span>
          </td>
        </tr>
        <tr class="collapseRow safari-card-fix">
          <td colspan="8">
            <flip-card params="{
                  dataId: $data.uuid(),
                  tabId: 'spells',
                  collapsable: true,
                  elementId: 'spell_list',
                  context: {
                    data: $data,
                    replaceInList: $component.replaceInList,
                    removeFromList: $component.removeFromList,
                    spellDamageIcon: $component.spellDamageIcon,
                  }
                }">
              <div class="front">
                 <spell-detail-view params="{
                      data: context.data,
                      containerId: elementId,
                      showBack: showBack,
                      flip: flip
                    }"></spell-detail-view>

              </div>
              <div class="back">
                <div data-bind="css: context.data.school().toLowerCase()">
                  <spell-form params="{
                    data: context.data,
                    containerId: elementId,
                    show: showBack,
                    flip: flip,
                    forceCardResize: forceCardResize,
                    replaceInParent: context.replaceInList,
                    removeFromParent: context.removeFromList
                   }"
                  ></spell-form>
                  </div>
              </div>
            </flip-card>
          </td>
        </tr>
        <!-- /ko -->
        <!-- ko if: entities().length > 0 && filteredAndSortedEntities().length == 0 -->
        <tr class="clickable">
          <td href="#"
              colspan="8"
              class="text-center">
            No Spells are currently castable
          </td>
        </tr>
        <!-- /ko -->
        <tr id="add-spell" class="collapse">
          <td colspan="8">
            <spell-form params="{
              containerId:'add-spell',
              show: $component.addForm,
              flip: $component.toggleaddForm,
              addToParent: $component.addToList
             }"
            ></spell-form>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="8">
            <div class="row">
            <div class="col-xs-4 text-muted">
              <!-- ko if: $component.spellStats().maxPrepared() -->
              <small class="table-foot-content visible-xs">Prepared: <span data-bind="text: $component.numberOfPrepared"></span></small>
              <span class="table-foot-content hidden-xs">Prepared: <span data-bind="text: $component.numberOfPrepared"></span> of <span data-bind="text: $component.spellStats().maxPrepared"></span></span>
              <!-- /ko -->
            </div>
            <div class="col-xs-4">
              <!-- ko ifnot: $component.addForm -->
            <button type="button"
                    class="btn btn-link btn-block btn-sm"
                    id="spellAddButton"
                    data-toggle="collapse"
                    data-target="#add-spell"
                    data-bind="click: toggleaddForm"><i class="fa fa-plus"></i> Add Spell</button>
              <!-- /ko -->
            </div>
              <div class="col-xs-4 text-muted">
                <small class="table-foot-content pull-right visible-xs">Spells: <span data-bind="text: $component.numberOfSpells"></span></small>
                <span class="table-foot-content pull-right hidden-xs">Total Spells: <span data-bind="text: $component.numberOfSpells"></span></span>
              </div>
            </div>
          </td>
        </tr>
      </tfoot>
      <!-- /ko -->
    </table>
</div>
