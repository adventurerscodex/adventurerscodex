<!-- ko if: visible -->
<div data-bind="if: loaded">
  <flip-card params="{
              tabId: 'environment-tab-ddsf',
              elementId: 'environment-section-id-ert',
              context: {
                data: $data,
               }
            }">
    <div class="front">
      <div class="card-title h4">
        <back-button params="{ column: $parents[2] }"></back-button>
        <span data-bind="text: context.data.name"></span><br />
        <small data-bind="text: context.data.tagline"></small>
        <card-edit-actions params="{ flip: flip }"></card-edit-actions>
      </div>
      <hr class="ac-table-header">
      <!-- ko with: context.data -->
      <div class="row">
        <div class="col-xs-8">
          <b>Weather:</b>&nbsp;<span data-bind="text: weatherLabel"></span><br>
          <b>Terrain:</b>&nbsp;<span data-bind="text: terrainLabel"></span>
        </div>
        <div class="col-xs-4 text-right">
            <!-- ko if: shouldShowExhibitButton -->
            <div class="text-center inline-block">
              <span style="font-weight: bold;">Exhibit</span><br>
              <a data-bind="click: toggleExhibit" href="#" title="Send Player's Exhibit">
                <i data-bind="css: { exhibitActiveIcon: environment().isExhibited }"
                    class="fa fa-desktop fa-color-hover">
                </i>
              </a>
            </div>
            <!-- /ko -->
            <!-- ko ifnot: shouldShowExhibitButton -->
            <div class="text-center inline-block">
              <span style="font-weight: bold;">Exhibit</span><br>
              <span class="fa fa-desktop fa-disabled" style="cursor:pointer;"
                data-bind="popover: { content: 'Join a Party send Player\'s Exhibit' }">
              </span>
            </div>
            <!-- /ko -->
          </div>
      </div>
      <hr data-bind="visible: shouldShowDividingMarker"/>
      <div class="d-flex">
        <div
          data-bind="markdownPreview: environment().description"
          class="preview-modal-overflow-sm d-flex-1 pl-1"
        ></div>
        <!-- ko if: environment().imageUrl -->
        <div class="d-flex-1">
          <img data-bind="attr: { src: convertedImageLink, width: imageWidth },
            css: imageClass, click: toggleFullScreen"
            class="img-responsive img-rounded clickable">
          <small>
            <em class="text-muted text-center col-xs-12">
              Click on the image to view it in Full Screen.
            </em>
          </small>
        </div>
        <!-- /ko -->
      </div>
      <!-- /ko -->
    </div>
    <div class="back">
      <div class="card-title h4">
        Environment
        <card-submit-actions params="{ reset: flip }"></card-submit-actions>
      </div>
      <hr class="ac-table-header">
      <!-- ko with: context.data -->
      <form class="form-horizontal" data-bind="validate: validation, submit: $parent.flip">
        <div class="form-group" data-bind="with: environment">
          <label class="col-sm-2 col-padded control-label">Image Link</label>
          <div class="col-sm-10 col-padded">
            <input type="text"
                   class="form-control"
                   name="imageUrl"
                   data-bind="value: imageUrl">
          </div>
          <label class="col-sm-2 col-padded control-label">Weather</label>
          <div class="col-sm-10 col-padded">
            <input type="text"
                   class="form-control"
                   name="weather"
                   data-bind="value: weather">
          </div>
          <label class="col-sm-2 col-padded control-label">Terrain</label>
          <div class="col-sm-10 col-padded">
            <input type="text"
                   class="form-control"
                   name="terrain"
                   data-bind="value: terrain">
          </div>
          <label class="col-sm-2 col-padded control-label">Description</label>
          <div class="col-sm-10 col-padded">
            <textarea type="text"
                    class="form-control" rows="4"
                    name="description"
                    data-bind="value: description, markdownEditor: true"></textarea>
          </div>
        </div>
      </form>
      <!-- /ko -->
    </div>
  </flip-card>
</div>

<!-- The visibility is managed internally -->
<full-screen-image params="imageSource: convertedImageLink, fullScreenStatus: fullScreen">
</full-screen-image>
<!-- /ko -->
